{% extends 'generic/_base.html' %}
{% load i18n %}

{% load static %}
{% block content %}
<form method="POST">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit" class="btn btn-primary">Save</button>
</form>
<script>
    document.addEventListener("DOMContentLoaded", function () {
      const objectTypeSelector = document.querySelector(".object-type-selector");
      const objectIdSelector = document.querySelector(".object-id-selector");
  
      objectTypeSelector.addEventListener("change", function () {
        const objectTypeId = this.value;
  
        // Disable and reset the Object ID field while fetching new data
        objectIdSelector.innerHTML = "<option value=''>---------</option>";
        objectIdSelector.disabled = true;
  
        if (!objectTypeId) return;
  
        // Fetch related objects for the selected object type
        fetch(`/api/plugins/netbox_servicemgmt/object-fields/${objectTypeId}/`)
        .then((response) => response.json())
          .then((data) => {
            objectIdSelector.disabled = false;
            objectIdSelector.innerHTML = "<option value=''>---------</option>";
            data.forEach((item) => {
              const option = document.createElement("option");
              option.value = item.id;
              option.textContent = item.name || item.display_name || `ID: ${item.id}`;
              objectIdSelector.appendChild(option);
            });
          })
          .catch((error) => {
            console.error("Error fetching objects:", error);
            objectIdSelector.disabled = false;
          });
      });
    });
  </script>
  
{% endblock %}
